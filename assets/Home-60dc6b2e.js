import{d as U,o as _,c as S,F as O,r as $,a as D,b as K,e as C,t as Q,u as w,l as de,_ as B,f as j,g as ce,h as P,i as k,w as L,j as G,k as z,m as F,v as ee,n as W,p as te,q as H,s as se,x as J,y as q,z as M,A as pe,B as ae,C as he,D as be,E as Z,G as me,$ as ye,H as A,I as le,J as fe,K as Se,L as xe,M as ie,N as we,O as Ce,P as ke,Q as Le,R as Me}from"./index-87bffb35.js";const De={class:"component-list"},Ie=["data-index"],Pe=U({__name:"ComponentList",setup(o){const e=t=>{t.dataTransfer.setData("index",t.target.dataset.index)};return(t,v)=>(_(),S("div",De,[(_(!0),S(O,null,$(w(de),(s,d)=>(_(),S("div",{key:d,class:"item",draggable:"true",onDragstart:v[0]||(v[0]=p=>e(p)),"data-index":d},[(_(),D(K(s.icon),{class:"icon"})),C("span",null,Q(s.label),1)],40,Ie))),128))]))}});const Ve=B(Pe,[["__scopeId","data-v-c47933ae"]]),Ae={class:"attr-list"},Oe=U({__name:"AttrList",setup(o){const e=z.editorStore,t=j({excludes:["Picture","Group"],textAlignOptions:[{label:"左对齐",value:"left"},{label:"居中",value:"center"},{label:"右对齐",value:"right"}],borderStyleOptions:[{label:"实线",value:"solid"},{label:"虚线",value:"dashed"}],verticalAlignOptions:[{label:"上对齐",value:"top"},{label:"居中对齐",value:"middle"},{label:"下对齐",value:"bottom"}],selectKey:["textAlign","borderStyle","verticalAlign"],map:{left:"x 坐标",top:"y 坐标",height:"高",width:"宽",color:"颜色",backgroundColor:"背景色",borderStyle:"边框风格",borderWidth:"边框宽度",borderColor:"边框颜色",borderRadius:"边框半径",fontSize:"字体大小",fontWeight:"字体粗细",lineHeight:"行高",letterSpacing:"字间距",opacity:"透明度",textAlign:"左右对齐",verticalAlign:"上下对齐"}}),v=ce(()=>e.editorState.curComponent?Object.keys(e.editorState.curComponent.style):[]),s=ce(()=>e.editorState.curComponent);return(d,p)=>{const h=P("el-color-picker"),c=P("el-option"),i=P("el-select"),a=P("el-input"),g=P("el-form-item"),m=P("el-form");return _(),S("div",Ae,[k(m,null,{default:L(()=>[(_(!0),S(O,null,$(v.value.filter(n=>n!="rotate"),(n,l)=>(_(),D(g,{key:l,label:t.map[n]},{default:L(()=>[n=="borderColor"?(_(),D(h,{key:0,modelValue:s.value.style[n],"onUpdate:modelValue":r=>s.value.style[n]=r},null,8,["modelValue","onUpdate:modelValue"])):n=="color"?(_(),D(h,{key:1,modelValue:s.value.style[n],"onUpdate:modelValue":r=>s.value.style[n]=r},null,8,["modelValue","onUpdate:modelValue"])):n=="backgroundColor"?(_(),D(h,{key:2,modelValue:s.value.style[n],"onUpdate:modelValue":r=>s.value.style[n]=r},null,8,["modelValue","onUpdate:modelValue"])):t.selectKey.includes(n)?(_(),D(i,{key:3,modelValue:s.value.style[n],"onUpdate:modelValue":r=>s.value.style[n]=r},{default:L(()=>[n=="textAlign"?(_(!0),S(O,{key:0},$(t.textAlignOptions,r=>(_(),D(c,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128)):n=="borderStyle"?(_(!0),S(O,{key:1},$(t.borderStyleOptions,r=>(_(),D(c,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128)):(_(!0),S(O,{key:2},$(t.verticalAlignOptions,r=>(_(),D(c,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(_(),D(a,{key:4,type:"number",modelValue:s.value.style[n],"onUpdate:modelValue":r=>s.value.style[n]=r},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),128)),s.value&&!t.excludes.includes(s.value.component)?(_(),D(g,{key:0,label:"内容"},{default:L(()=>[k(a,{type:"textarea",modelValue:s.value.propValue,"onUpdate:modelValue":p[0]||(p[0]=n=>s.value.propValue=n)},null,8,["modelValue"])]),_:1})):G("",!0)]),_:1})])}}});const Ee=B(Oe,[["__scopeId","data-v-36b96b2b"]]),Re=U({__name:"ContextMenu",setup(o){const e=z.editorStore;j({copyData:null});const t=()=>{e.setClickComponentStatus(!0)},v=()=>{e.lock()},s=()=>{e.unlock()},d=()=>{e.copy()},p=()=>{e.paste(!0),e.recordSnapshot()},h=()=>{e.cut()},c=()=>{e.deleteComponent(),e.recordSnapshot()},i=()=>{e.upComponent(),e.recordSnapshot()},a=()=>{e.downComponent(),e.recordSnapshot()},g=()=>{e.topComponent(),e.recordSnapshot()},m=()=>{e.bottomComponent(),e.recordSnapshot()};return(n,l)=>F((_(),S("div",{class:"contextmenu",style:W({top:w(e).editorState.menuTop+"px",left:w(e).editorState.menuLeft+"px"})},[C("ul",{onMouseup:t},[w(e).editorState.curComponent?(_(),S(O,{key:0},[w(e).editorState.curComponent.isLock?(_(),S("li",{key:1,onClick:s},"解锁")):(_(),S(O,{key:0},[C("li",{onClick:d},"复制"),C("li",{onClick:p},"粘贴"),C("li",{onClick:h},"剪切"),C("li",{onClick:c},"删除"),C("li",{onClick:v},"锁定"),C("li",{onClick:g},"置顶"),C("li",{onClick:m},"置底"),C("li",{onClick:i},"上移"),C("li",{onClick:a},"下移")],64))],64)):(_(),S("li",{key:1,onClick:p},"粘贴"))],32)],4)),[[ee,w(e).editorState.menuShow]])}});const Ne=B(Re,[["__scopeId","data-v-c1805e3b"]]),$e={class:"mark-line"},Ue=U({__name:"MarkLine",setup(o){const e=z.editorStore,t=new Map,v=(a,g)=>{a&&t.set(g,a)},s=j({lines:["xt","xc","xb","yl","yc","yr"],diff:3,lineStatus:{xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}});te(()=>{H.on("move",a=>{p(a.isDownward,a.isRightward)}),H.on("unMove",()=>{d()})});const d=()=>{Object.keys(s.lineStatus).forEach(a=>{s.lineStatus[a]=!1})},p=(a,g)=>{const m=e.editorState.componentData,n=se(e.editorState.curComponent.style),l=n.width/2,r=n.height/2;d(),m.forEach(b=>{if(b==e.editorState.curComponent)return;const y=se(b.style),{top:u,left:f,bottom:x,right:I}=y,V=y.width/2,Y=y.height/2,E={top:[{isNearly:i(n.top,u),lineNode:t.get("xt"),line:"xt",dragShift:u,lineShift:u},{isNearly:i(n.bottom,u),lineNode:t.get("xt"),line:"xt",dragShift:u-n.height,lineShift:u},{isNearly:i(n.top+r,u+Y),lineNode:t.get("xc"),line:"xc",dragShift:u+Y-r,lineShift:u+Y},{isNearly:i(n.top,x),lineNode:t.get("xb"),line:"xb",dragShift:x,lineShift:x},{isNearly:i(n.bottom,x),lineNode:t.get("xb"),line:"xb",dragShift:x-n.height,lineShift:x}],left:[{isNearly:i(n.left,f),lineNode:t.get("yl"),line:"yl",dragShift:f,lineShift:f},{isNearly:i(n.right,f),lineNode:t.get("yl"),line:"yl",dragShift:f-n.width,lineShift:f},{isNearly:i(n.left+l,f+V),lineNode:t.get("yc"),line:"yc",dragShift:f+V-l,lineShift:f+V},{isNearly:i(n.left,I),lineNode:t.get("yr"),line:"yr",dragShift:I,lineShift:I},{isNearly:i(n.right,I),lineNode:t.get("yr"),line:"yr",dragShift:I-n.width,lineShift:I}]},R=[],{rotate:T}=e.editorState.curComponent.style;Object.keys(E).forEach(X=>{E[X].forEach(N=>{N.isNearly&&(e.setShapeSingleStyle({key:X,value:T!=0?h(X,N,n):N.dragShift}),N.lineNode.style[X]=`${N.lineShift}px`,R.push(N.line))})}),R.length&&c(R,a,g)})},h=(a,g,m)=>{const{width:n,height:l}=e.editorState.curComponent.style;return a=="top"?Math.round(g.dragShift-(l-m.height)/2):Math.round(g.dragShift-(n-m.width)/2)},c=(a,g,m)=>{m?a.includes("yr")?s.lineStatus.yr=!0:a.includes("yc")?s.lineStatus.yc=!0:a.includes("yl")&&(s.lineStatus.yl=!0):a.includes("yl")?s.lineStatus.yl=!0:a.includes("yc")?s.lineStatus.yc=!0:a.includes("yr")&&(s.lineStatus.yr=!0),g?a.includes("xb")?s.lineStatus.xb=!0:a.includes("xc")?s.lineStatus.xc=!0:a.includes("xt")&&(s.lineStatus.xt=!0):a.includes("xt")?s.lineStatus.xt=!0:a.includes("xc")?s.lineStatus.xc=!0:a.includes("xb")&&(s.lineStatus.xb=!0)},i=(a,g)=>Math.abs(a-g)<=s.diff;return(a,g)=>(_(),S("div",$e,[(_(!0),S(O,null,$(s.lines,m=>F((_(),S("div",{key:m,class:J(["line",m.includes("x")?"xline":"yline"]),ref_for:!0,ref:n=>v(n,m)},null,2)),[[ee,s.lineStatus[m]||!1]])),128))]))}});const Be=B(Ue,[["__scopeId","data-v-ffbd92d2"]]);async function _e(o,e=[]){if(o){const t=v=>new Promise(s=>{o.classList.add("animate__animated","animate__"+v.value);const d=()=>{o.removeEventListener("animationend",d),o.removeEventListener("animationcancel",d),o.classList.remove("animate__animated","animate__"+v.value),s()};o.addEventListener("animationend",d),o.addEventListener("animationcancel",d)});for(let v=0,s=e.length;v<s;v++)await t(e[v])}else console.log("runAnimation el为空")}const Ye={lt:Xe,t:We,rt:Te,r:je,rb:He,b:qe,lb:ze,l:Ge};function Xe(o,e,t,v,s){const{symmetricPoint:d}=s;let p=q(e,d),h=M(e,p,-o.rotate),c=M(d,p,-o.rotate),i=c.x-h.x,a=c.y-h.y;if(v){i/a>t?(h.x+=Math.abs(i-a*t),i=a*t):(h.y+=Math.abs(a-i/t),a=i/t);const g=M(h,p,o.rotate);p=q(g,d),h=M(g,p,-o.rotate),c=M(d,p,-o.rotate),i=c.x-h.x,a=c.y-h.y}i>0&&a>0&&(o.width=Math.round(i),o.height=Math.round(a),o.left=Math.round(h.x),o.top=Math.round(h.y))}function Te(o,e,t,v,s){const{symmetricPoint:d}=s;let p=q(e,d),h=M(e,p,-o.rotate),c=M(d,p,-o.rotate),i=h.x-c.x,a=c.y-h.y;if(v){i/a>t?(h.x-=Math.abs(i-a*t),i=a*t):(h.y+=Math.abs(a-i/t),a=i/t);const g=M(h,p,o.rotate);p=q(g,d),h=M(g,p,-o.rotate),c=M(d,p,-o.rotate),i=h.x-c.x,a=c.y-h.y}i>0&&a>0&&(o.width=Math.round(i),o.height=Math.round(a),o.left=Math.round(c.x),o.top=Math.round(h.y))}function He(o,e,t,v,s){const{symmetricPoint:d}=s;let p=q(e,d),h=M(d,p,-o.rotate),c=M(e,p,-o.rotate),i=c.x-h.x,a=c.y-h.y;if(v){i/a>t?(c.x-=Math.abs(i-a*t),i=a*t):(c.y-=Math.abs(a-i/t),a=i/t);const g=M(c,p,o.rotate);p=q(g,d),h=M(d,p,-o.rotate),c=M(g,p,-o.rotate),i=c.x-h.x,a=c.y-h.y}i>0&&a>0&&(o.width=Math.round(i),o.height=Math.round(a),o.left=Math.round(h.x),o.top=Math.round(h.y))}function ze(o,e,t,v,s){const{symmetricPoint:d}=s;let p=q(e,d),h=M(d,p,-o.rotate),c=M(e,p,-o.rotate),i=h.x-c.x,a=c.y-h.y;if(v){i/a>t?(c.x+=Math.abs(i-a*t),i=a*t):(c.y-=Math.abs(a-i/t),a=i/t);const g=M(c,p,o.rotate);p=q(g,d),h=M(d,p,-o.rotate),c=M(g,p,-o.rotate),i=h.x-c.x,a=c.y-h.y}i>0&&a>0&&(o.width=Math.round(i),o.height=Math.round(a),o.left=Math.round(c.x),o.top=Math.round(h.y))}function We(o,e,t,v,s){const{symmetricPoint:d,curPoint:p}=s,h=M(e,p,-o.rotate),c=M({x:p.x,y:h.y},p,o.rotate),i=Math.sqrt((c.x-d.x)**2+(c.y-d.y)**2);if(i>0){const a={x:c.x-(c.x-d.x)/2,y:c.y+(d.y-c.y)/2};let g=o.width;v&&(g=i*t),o.width=g,o.height=Math.round(i),o.top=Math.round(a.y-i/2),o.left=Math.round(a.x-o.width/2)}}function je(o,e,t,v,s){const{symmetricPoint:d,curPoint:p}=s,h=M(e,p,-o.rotate),c=M({x:h.x,y:p.y},p,o.rotate),i=Math.sqrt((c.x-d.x)**2+(c.y-d.y)**2);if(i>0){const a={x:c.x-(c.x-d.x)/2,y:c.y+(d.y-c.y)/2};let g=o.height;v&&(g=i/t),o.height=g,o.width=Math.round(i),o.top=Math.round(a.y-o.height/2),o.left=Math.round(a.x-i/2)}}function qe(o,e,t,v,s){const{symmetricPoint:d,curPoint:p}=s,h=M(e,p,-o.rotate),c=M({x:p.x,y:h.y},p,o.rotate),i=Math.sqrt((c.x-d.x)**2+(c.y-d.y)**2);if(i>0){const a={x:c.x-(c.x-d.x)/2,y:c.y+(d.y-c.y)/2};let g=o.width;v&&(g=i*t),o.width=g,o.height=Math.round(i),o.top=Math.round(a.y-i/2),o.left=Math.round(a.x-o.width/2)}}function Ge(o,e,t,v,s){const{symmetricPoint:d,curPoint:p}=s,h=M(e,p,-o.rotate),c=M({x:h.x,y:p.y},p,o.rotate),i=Math.sqrt((c.x-d.x)**2+(c.y-d.y)**2);if(i>0){const a={x:c.x-(c.x-d.x)/2,y:c.y+(d.y-c.y)/2};let g=o.height;v&&(g=i/t),o.height=g,o.width=Math.round(i),o.top=Math.round(a.y-o.height/2),o.left=Math.round(a.x-i/2)}}function Fe(o,e,t,v,s,d){Ye[o](e,t,v,s,d)}const Je=["onMousedown"],Ke=U({__name:"ShapeComponent",props:{active:{type:Boolean,default:!1},element:{require:!0,type:Object},defaultStyle:{require:!0,type:Object},index:{require:!0,type:[Number,String]}},setup(o){const e=o,t=z.editorStore,v=pe(),s=j({pointList:["lt","t","rt","r","rb","b","lb","l"],initialAngle:{lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315},angleToCursor:[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}],cursors:{}});te(()=>{t.editorState.curComponent&&(s.cursors=c()),H.on("runAnimation",()=>{e.element===t.getCurComponent&&v.value!==void 0&&_e(v.value,t.getCurComponent.animations)})});const d=()=>{var l;return e.active&&!((l=e.element)!=null&&l.isLock)},p=l=>{var T;t.setClickComponentStatus(!0),l.preventDefault(),l.stopPropagation();const r={...e.defaultStyle},b=l.clientY,y=l.clientX,u=r.rotate,f=(T=v.value)==null?void 0:T.getBoundingClientRect(),x=(f==null?void 0:f.left)+(f==null?void 0:f.width)/2,I=(f==null?void 0:f.top)+(f==null?void 0:f.height)/2,V=Math.atan2(b-I,y-x)/(Math.PI/180);let Y=!1;const E=X=>{Y=!0;const N=X.clientX,ne=X.clientY,ge=Math.atan2(ne-I,N-x)/(Math.PI/180);r.rotate=u+ge-V,t.setShapeStyle(r)},R=()=>{Y&&t.recordSnapshot(),document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",R),s.cursors=c()};document.addEventListener("mousemove",E),document.addEventListener("mouseup",R)},h=l=>{var E,R;const r=(E=e.defaultStyle)==null?void 0:E.height,b=(R=e.defaultStyle)==null?void 0:R.width,y=/t/.test(l),u=/b/.test(l),f=/l/.test(l),x=/r/.test(l);let I=0,V=0;return l.length===2?(I=f?0:b,V=y?0:r):((y||u)&&(I=b/2,V=y?0:r),(f||x)&&(I=f?0:b,V=Math.floor(r/2))),{marginLeft:"-4px",marginTop:"-4px",left:`${I}px`,top:`${V}px`,cursor:s.cursors[l]}},c=()=>{const l=ae(t.editorState.curComponent.style.rotate),r={};let b=-1;return s.pointList.forEach(y=>{const u=ae(s.initialAngle[y]+l),f=s.angleToCursor.length;for(;;){b=(b+1)%f;const x=s.angleToCursor[b];if(u<23||u>=338){r[y]="nw-resize";return}if(x.start<=u&&u<x.end){r[y]=x.cursor+"-resize";return}}}),r},i=l=>{var Y,E,R;if(t.setClickComponentStatus(!0),((Y=e.element)==null?void 0:Y.component)!="v-text"&&((E=e.element)==null?void 0:E.component)!="rect-shape"&&l.preventDefault(),l.stopPropagation(),t.setCurComponent({component:e.element,index:e.index}),(R=e.element)!=null&&R.isLock)return;s.cursors=c();const r={...e.defaultStyle},b=l.clientY,y=l.clientX,u=Number(r.top),f=Number(r.left);let x=!1;const I=T=>{x=!0;const X=T.clientX,N=T.clientY;r.top=N-b+u,r.left=X-y+f,t.setShapeStyle(r),be(()=>{H.emit("move",{isDownward:N-b>0,isRightward:X-y>0})})},V=()=>{x&&t.recordSnapshot(),H.emit("unMove"),document.removeEventListener("mousemove",I),document.removeEventListener("mouseup",V)};document.addEventListener("mousemove",I),document.addEventListener("mouseup",V)},a=l=>{l.stopPropagation(),l.preventDefault(),t.hideContextMenu()},g=(l,r)=>{t.setClickComponentStatus(!0),r.stopPropagation(),r.preventDefault();const b={...e.defaultStyle},y=b.width/b.height,u={x:b.left+b.width/2,y:b.top+b.height/2},f=t.editorState.editor.getBoundingClientRect(),x=n(f,r),I={x:r.clientX-f.left+x.x,y:r.clientY-f.top+x.y},V={x:u.x-(I.x-u.x),y:u.y-(I.y-u.y)};let Y=!1,E=!0;const R=m(),T=N=>{if(E){E=!1;return}Y=!0;const ne={x:N.clientX-f.left+x.x,y:N.clientY-f.top+x.y};Fe(l,b,ne,y,R,{center:u,curPoint:I,symmetricPoint:V}),t.setShapeStyle(b)},X=()=>{document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",X),Y&&t.recordSnapshot()};document.addEventListener("mousemove",T),document.addEventListener("mouseup",X)},m=()=>{var r;if(((r=e.element)==null?void 0:r.component)!="Group")return!1;const l=[0,90,180,360];for(const b of e.element.propValue)if(!l.includes(ae(parseInt(b.style.rotate))))return!0;return!1},n=(l,r)=>{const b={x:r.clientX-l.left,y:r.clientY-l.top},y=r.target.getBoundingClientRect(),u={x:y.left-l.left+r.target.offsetWidth/2,y:y.top-l.top+r.target.offsetHeight/2};return{x:u.x-b.x,y:u.y-b.y}};return(l,r)=>{const b=P("RefreshRight"),y=P("el-icon");return _(),S("div",{ref_key:"thisRef",ref:v,class:J(["shape",{active:o.active}]),onClick:a,onMousedown:i},[F(k(y,{class:"el-icon-refresh-right",onMousedown:p},{default:L(()=>[k(b)]),_:1},512),[[ee,d()]]),(_(!0),S(O,null,$(d()?s.pointList:[],u=>(_(),S("div",{class:"shape-point",onMousedown:f=>g(u,f),key:u,style:W(h(u))},null,44,Je))),128)),he(l.$slots,"default",{},void 0,!0)],34)}}});const Qe=B(Ke,[["__scopeId","data-v-1d8ebec4"]]),Ze=U({__name:"AreaComponent",props:{start:{type:Object},width:{type:Number},height:{type:Number}},setup(o){return(e,t)=>(_(),S("div",{style:W({left:o.start.x+"px",top:o.start.y+"px",width:o.width+"px",height:o.height+"px"}),class:"area"},null,4))}});const et=B(Ze,[["__scopeId","data-v-b92f54dd"]]),tt=U({__name:"EditorComponent",props:{isEdit:{type:Boolean,default:!0}},setup(o){const e=j({editorX:0,editorY:0,start:{x:0,y:0},width:0,height:0,isShowArea:!1}),t=z.editorStore;te(()=>{t.getEditor(),H.on("hideArea",()=>{s()})});const v=m=>{const n=t.editorState.curComponent;(!n||n.component!="v-text"&&n.component!="rect-shape")&&m.preventDefault(),s();const l=t.editorState.editor.getBoundingClientRect();e.editorX=l.x,e.editorY=l.y;const r=m.clientX,b=m.clientY;e.start.x=r-e.editorX,e.start.y=b-e.editorY,e.isShowArea=!0;const y=f=>{e.width=Math.abs(f.clientX-r),e.height=Math.abs(f.clientY-b),f.clientX<r&&(e.start.x=f.clientX-e.editorX),f.clientY<b&&(e.start.y=f.clientY-e.editorY)},u=f=>{if(document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",u),f.clientX==r&&f.clientY==b){s();return}d()};document.addEventListener("mousemove",y),document.addEventListener("mouseup",u)},s=()=>{e.isShowArea=!1,e.width=0,e.height=0},d=()=>{const m=p();if(m.length<=1){s();return}let n=1/0,l=1/0,r=-1/0,b=-1/0;m.forEach(y=>{let u={};y.component=="VGroup"?y.propValue.forEach(f=>{const x=ye(`#component${f.id}`).getBoundingClientRect();u.left=x.left-e.editorX,u.top=x.top-e.editorY,u.right=x.right-e.editorX,u.bottom=x.bottom-e.editorY,u.left<l&&(l=u.left),u.top<n&&(n=u.top),u.right>r&&(r=u.right),u.bottom>b&&(b=u.bottom)}):u=se(y.style),u.left<l&&(l=u.left),u.top<n&&(n=u.top),u.right>r&&(r=u.right),u.bottom>b&&(b=u.bottom)}),e.start.x=l,e.start.y=n,e.width=r-l,e.height=b-n,t.setAreaData({style:{left:l,top:n,width:e.width,height:e.height},components:m})},p=()=>{const m=[],{x:n,y:l}=e.start;return t.editorState.componentData.forEach(r=>{if(r.isLock)return;const{left:b,top:y,width:u,height:f}=r.style;n<=b&&l<=y&&b+u<=n+e.width&&y+f<=l+e.height&&m.push(r)}),m},h=m=>{m.stopPropagation(),m.preventDefault();let n=m.target,l=m.offsetY,r=m.offsetX;for(;n instanceof SVGElement;)n=n.parentNode;for(;!n.className.includes("editor");)r+=n.offsetLeft,l+=n.offsetTop,n=n.parentNode;t.showContextMenu({top:l,left:r})},c=m=>{const n={};return["width","height","top","left","rotate"].forEach(l=>{l!="rotate"?n[l]=m[l]+"px":n.transform="rotate("+m[l]+"deg)"}),n},i=m=>me(m,["top","left","width","height","rotate"]),a=(m,n)=>{t.setShapeStyle({height:g(m,n)})},g=(m,n)=>{let{lineHeight:l,fontSize:r,height:b}=m.style;l===""&&(l=1.5);const y=(n.split("<br>").length-1)*l*r;return b>y?b:y};return(m,n)=>(_(),S("div",{class:J(["editor",{edit:o.isEdit}]),id:"editor",style:W({width:w(Z)(w(t).editorState.canvasStyleData.width)+"px",height:w(Z)(w(t).editorState.canvasStyleData.height)+"px"}),onContextmenu:h,onMousedown:v},[(_(!0),S(O,null,$(w(t).editorState.componentData,(l,r)=>(_(),D(Qe,{defaultStyle:l.style,style:W(c(l.style)),key:l.id,active:l===w(t).editorState.curComponent,element:l,index:r,class:J({lock:l.isLock})},{default:L(()=>[l.component!="v-text"?(_(),D(K(l.component),{key:0,class:"component",style:W(i(l.style)),propValue:l.propValue,element:l,id:"component"+l.id},null,8,["style","propValue","element","id"])):(_(),D(K(l.component),{key:1,class:"component",style:W(i(l.style)),propValue:l.propValue,onInput:a,element:l,id:"component"+l.id},null,40,["style","propValue","element","id"]))]),_:2},1032,["defaultStyle","style","active","element","index","class"]))),128)),k(Ne),k(Be),F(k(et,{start:e.start,width:e.width,height:e.height},null,8,["start","width","height"]),[[ee,e.isShowArea]])],38))}});const ot=B(tt,[["__scopeId","data-v-5541cf4c"]]),re={redirect(o){o&&(window.location.href=o)},alert(o){o&&alert(o)}},nt=[{key:"redirect",label:"跳转事件",event:re.redirect,param:""},{key:"alert",label:"alert 事件",event:re.alert,param:""}],at=U({__name:"ComponentWrapper",props:{config:{}},setup(o){const e=o,t=pe();te(()=>{t.value!==void 0&&_e(t.value,e.config.animations)});const v=()=>{const s=e.config.events;Object.keys(s).forEach(d=>{re[d](s[d])})};return(s,d)=>(_(),S("div",{onClick:v,ref_key:"wrapperDom",ref:t},[(_(),D(K(s.config.component),{class:"component",style:W(w(me)(s.config.style)),propValue:s.config.propValue,element:s.config},null,8,["style","propValue","element"]))],512))}});const lt=B(at,[["__scopeId","data-v-f9a224a7"]]),st={key:0,class:"bg"},it={class:"canvas-container"},rt=U({__name:"Preview",props:{show:{type:Boolean}},emits:["update:show"],setup(o,{emit:e}){const t=z.editorStore.editorState,v=()=>{e("update:show",!1)};return(s,d)=>{const p=P("el-button");return s.show?(_(),S("div",st,[k(p,{onClick:v,class:"close"},{default:L(()=>[A("关闭")]),_:1}),C("div",it,[C("div",{class:"canvas",style:W({width:w(Z)(w(t).canvasStyleData.width)+"px",height:w(Z)(w(t).canvasStyleData.height)+"px"})},[(_(!0),S(O,null,$(w(t).componentData,(h,c)=>(_(),D(lt,{key:c,config:h},null,8,["config"]))),128))],4)])])):G("",!0)}}});const ct=B(rt,[["__scopeId","data-v-6b193d50"]]),oe=o=>(ke("data-v-dae67014"),o=o(),Le(),o),ut={class:"toolbar"},dt=oe(()=>C("label",{for:"input",class:"insert"},"插入图片",-1)),pt={class:"canvas-config"},ht=oe(()=>C("span",null,"画布大小",-1)),mt=oe(()=>C("span",null,"*",-1)),ft={class:"canvas-config"},_t=oe(()=>C("span",null,"画布比例",-1)),vt=U({__name:"Toolbar",setup(o){const e=z.editorStore,t=j({isShowPreview:!1,needToChange:["top","left","width","height","fontSize","borderWidth"],scale:100,timer:null}),v=y=>y*t.scale/100,s=y=>{const u=e.editorState.canvasStyleData.scale;return y/(u/100)},d=()=>{clearTimeout(t.timer),t.scale=~~t.scale||1,t.timer=setTimeout(()=>{const y=fe.cloneDeep(e.editorState.componentData);y.forEach(u=>{Object.keys(u.style).forEach(f=>{t.needToChange.includes(f)&&(u.style[f]=v(s(u.style[f])))})}),e.setComponentData(y),e.setCanvasStyle({...e.editorState.canvasStyleData,scale:t.scale})},500)},p=()=>{e.lock()},h=()=>{e.unlock()},c=()=>{e.compose(),e.recordSnapshot()},i=()=>{e.decompose(),e.recordSnapshot()},a=()=>{e.undo()},g=()=>{e.redo()},m=y=>{const u=y.target.files[0];if(!u.type.includes("image")){Se("只能插入图片");return}const f=new FileReader;f.onload=x=>{const I=x.target.result,V=new Image;V.onload=()=>{e.addComponent({component:{...xe,id:ie(),component:"v-picture",label:"图片",icon:"",propValue:I,style:{...we,top:0,left:0,width:V.width,height:V.height}},index:void 0})},V.src=I},f.readAsDataURL(u)},n=()=>{t.isShowPreview=!0,e.setEditMode("preview")},l=()=>{e.setEditMode("edit")},r=()=>{localStorage.setItem("canvasData",JSON.stringify(e.editorState.componentData)),localStorage.setItem("canvasStyle",JSON.stringify(e.editorState.canvasStyleData)),Ce.success("保存成功")},b=()=>{e.setComponentData([]),e.recordSnapshot()};return H.on("preview",n),H.on("save",r),H.on("clearCanvas",b),t.scale=e.editorState.canvasStyleData.scale,(y,u)=>{const f=P("el-button");return _(),S("div",null,[C("div",ut,[k(f,{onClick:a},{default:L(()=>[A("撤消")]),_:1}),k(f,{onClick:g},{default:L(()=>[A("重做")]),_:1}),dt,C("input",{type:"file",onChange:m,id:"input",hidden:""},null,32),k(f,{onClick:n,style:{"margin-left":"10px"}},{default:L(()=>[A("预览")]),_:1}),k(f,{onClick:r},{default:L(()=>[A("保存")]),_:1}),k(f,{onClick:b},{default:L(()=>[A("清空画布")]),_:1}),k(f,{onClick:c,disabled:!w(e).editorState.areaData.components.length},{default:L(()=>[A("组合")]),_:1},8,["disabled"]),k(f,{onClick:i,disabled:!w(e).editorState.curComponent||w(e).editorState.curComponent.isLock||w(e).editorState.curComponent.component!="VGroup"},{default:L(()=>[A("拆分")]),_:1},8,["disabled"]),k(f,{onClick:p,disabled:!w(e).editorState.curComponent||w(e).editorState.curComponent.isLock},{default:L(()=>[A("锁定")]),_:1},8,["disabled"]),k(f,{onClick:h,disabled:!w(e).editorState.curComponent||!w(e).editorState.curComponent.isLock},{default:L(()=>[A("解锁")]),_:1},8,["disabled"]),C("div",pt,[ht,F(C("input",{"onUpdate:modelValue":u[0]||(u[0]=x=>w(e).editorState.canvasStyleData.width=x)},null,512),[[le,w(e).editorState.canvasStyleData.width]]),mt,F(C("input",{"onUpdate:modelValue":u[1]||(u[1]=x=>w(e).editorState.canvasStyleData.height=x)},null,512),[[le,w(e).editorState.canvasStyleData.height]])]),C("div",ft,[_t,F(C("input",{"onUpdate:modelValue":u[2]||(u[2]=x=>t.scale=x),onInput:d},null,544),[[le,t.scale]]),A(" % ")])]),k(ct,{show:t.isShowPreview,"onUpdate:show":u[3]||(u[3]=x=>t.isShowPreview=x),onChange:l},null,8,["show"])])}}});const gt=B(vt,[["__scopeId","data-v-dae67014"]]),ue=[{label:"进入",children:[{label:"渐显",value:"fadeIn"},{label:"向右进入",value:"fadeInLeft"},{label:"向左进入",value:"fadeInRight"},{label:"向上进入",value:"fadeInUp"},{label:"向下进入",value:"fadeInDown"},{label:"向右长距进入",value:"fadeInLeftBig"},{label:"向左长距进入",value:"fadeInRightBig"},{label:"向上长距进入",value:"fadeInUpBig"},{label:"向下长距进入",value:"fadeInDownBig"},{label:"旋转进入",value:"rotateIn"},{label:"左顺时针旋转",value:"rotateInDownLeft"},{label:"右逆时针旋转",value:"rotateInDownRight"},{label:"左逆时针旋转",value:"rotateInUpLeft"},{label:"右逆时针旋转",value:"rotateInUpRight"},{label:"弹入",value:"bounceIn"},{label:"向右弹入",value:"bounceInLeft"},{label:"向左弹入",value:"bounceInRight"},{label:"向上弹入",value:"bounceInUp"},{label:"向下弹入",value:"bounceInDown"},{label:"光速从右进入",value:"lightSpeedInRight"},{label:"光速从左进入",value:"lightSpeedInLeft"},{label:"光速从右退出",value:"lightSpeedOutRight"},{label:"光速从左退出",value:"lightSpeedOutLeft"},{label:"Y轴旋转",value:"flip"},{label:"中心X轴旋转",value:"flipInX"},{label:"中心Y轴旋转",value:"flipInY"},{label:"左长半径旋转",value:"rollIn"},{label:"由小变大进入",value:"zoomIn"},{label:"左变大进入",value:"zoomInLeft"},{label:"右变大进入",value:"zoomInRight"},{label:"向上变大进入",value:"zoomInUp"},{label:"向下变大进入",value:"zoomInDown"},{label:"向右滑动展开",value:"slideInLeft"},{label:"向左滑动展开",value:"slideInRight"},{label:"向上滑动展开",value:"slideInUp"},{label:"向下滑动展开",value:"slideInDown"}]},{label:"强调",children:[{label:"弹跳",value:"bounce"},{label:"闪烁",value:"flash"},{label:"放大缩小",value:"pulse"},{label:"放大缩小弹簧",value:"rubberBand"},{label:"左右晃动",value:"headShake"},{label:"左右扇形摇摆",value:"swing"},{label:"放大晃动缩小",value:"tada"},{label:"扇形摇摆",value:"wobble"},{label:"左右上下晃动",value:"jello"},{label:"Y轴旋转",value:"flip"}]},{label:"退出",children:[{label:"渐隐",value:"fadeOut"},{label:"向左退出",value:"fadeOutLeft"},{label:"向右退出",value:"fadeOutRight"},{label:"向上退出",value:"fadeOutUp"},{label:"向下退出",value:"fadeOutDown"},{label:"向左长距退出",value:"fadeOutLeftBig"},{label:"向右长距退出",value:"fadeOutRightBig"},{label:"向上长距退出",value:"fadeOutUpBig"},{label:"向下长距退出",value:"fadeOutDownBig"},{label:"旋转退出",value:"rotateOut"},{label:"左顺时针旋转",value:"rotateOutDownLeft"},{label:"右逆时针旋转",value:"rotateOutDownRight"},{label:"左逆时针旋转",value:"rotateOutUpLeft"},{label:"右逆时针旋转",value:"rotateOutUpRight"},{label:"弹出",value:"bounceOut"},{label:"向左弹出",value:"bounceOutLeft"},{label:"向右弹出",value:"bounceOutRight"},{label:"向上弹出",value:"bounceOutUp"},{label:"向下弹出",value:"bounceOutDown"},{label:"中心X轴旋转",value:"flipOutX"},{label:"中心Y轴旋转",value:"flipOutY"},{label:"左长半径旋转",value:"rollOut"},{label:"由小变大退出",value:"zoomOut"},{label:"左变大退出",value:"zoomOutLeft"},{label:"右变大退出",value:"zoomOutRight"},{label:"向上变大退出",value:"zoomOutUp"},{label:"向下变大退出",value:"zoomOutDown"},{label:"向左滑动收起",value:"slideOutLeft"},{label:"向右滑动收起",value:"slideOutRight"},{label:"向上滑动收起",value:"slideOutUp"},{label:"向下滑动收起",value:"slideOutDown"}]}],bt=U({__name:"Modal",props:{show:{type:Boolean}},emits:["update:show"],setup(o,{emit:e}){const t=()=>{e("update:show")},v=s=>{s.stopPropagation()};return(s,d)=>s.show?(_(),S("div",{key:0,class:"modal-bg",onClick:t},[C("div",{class:"fadeInLeft animated modal",onClick:v},[he(s.$slots,"default",{},void 0,!0)])])):G("",!0)}});const ve=B(bt,[["__scopeId","data-v-b4747281"]]),yt={class:"animation-list"},St={key:0,class:"div-animation"},xt={class:"el-scrollbar-view"},wt=["onMouseover","onClick"],Ct=U({__name:"AnimationList",setup(o){const e=z.editorStore,t=j({isShowAnimation:!1,animationClassData:ue,animationActiveName:"进入",showAnimatePanel:!1,hoverPreviewAnimate:""}),v=p=>{e.addAnimation(p),t.isShowAnimation=!1},s=()=>{H.emit("runAnimation")},d=p=>{e.removeAnimation(p)};return(p,h)=>{const c=P("el-button"),i=P("el-tag"),a=P("el-scrollbar"),g=P("el-tab-pane"),m=P("el-tabs");return _(),S("div",yt,[w(e).editorState.curComponent?(_(),S("div",St,[k(c,{onClick:h[0]||(h[0]=n=>{t.isShowAnimation=!0})},{default:L(()=>[A("添加动画")]),_:1}),k(c,{onClick:s},{default:L(()=>[A("预览动画")]),_:1}),C("div",null,[(_(!0),S(O,null,$(w(e).editorState.curComponent.animations,(n,l)=>(_(),D(i,{key:l,closable:"",onClose:r=>d(l)},{default:L(()=>[A(Q(n.label),1)]),_:2},1032,["onClose"]))),128))])])):G("",!0),k(ve,{show:t.isShowAnimation,"onUpdate:show":h[2]||(h[2]=n=>t.isShowAnimation=n)},{default:L(()=>[k(m,{type:"card",modelValue:t.animationActiveName,"onUpdate:modelValue":h[1]||(h[1]=n=>t.animationActiveName=n)},{default:L(()=>[(_(!0),S(O,null,$(w(ue),n=>(_(),D(g,{key:n.label,label:n.label,name:n.label},{default:L(()=>[k(a,{class:"animate-container"},{default:L(()=>[C("div",xt,[(_(!0),S(O,null,$(n.children,(l,r)=>(_(),S("div",{class:"animate",key:r,onMouseover:b=>t.hoverPreviewAnimate=l.value,onClick:b=>v(l)},[C("div",{class:J([t.hoverPreviewAnimate===l.value&&"animate__animated animate__"+l.value])},Q(l.label),3)],40,wt))),128))])]),_:2},1024)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["show"])])}}});const kt=B(Ct,[["__scopeId","data-v-41b1b119"]]),Lt={class:"event-list"},Mt={key:0,class:"div-events"},Dt=U({__name:"EventList",setup(o){const e=z.editorStore,t=j({isShowEvent:!1,eventURL:"",eventActiveName:"redirect",eventList:nt}),v=(d,p)=>{t.isShowEvent=!1,e.addEvent({event:d,param:p})},s=d=>{e.removeEvent(d)};return(d,p)=>{const h=P("el-button"),c=P("el-tag"),i=P("el-input"),a=P("el-tab-pane"),g=P("el-tabs");return _(),S("div",Lt,[w(e).editorState.curComponent?(_(),S("div",Mt,[k(h,{onClick:p[0]||(p[0]=m=>t.isShowEvent=!0)},{default:L(()=>[A("添加事件")]),_:1}),C("div",null,[(_(!0),S(O,null,$(Object.keys(w(e).editorState.curComponent.events),m=>(_(),D(c,{key:m,closable:"",onClose:n=>s(m)},{default:L(()=>[A(Q(m),1)]),_:2},1032,["onClose"]))),128))])])):G("",!0),k(ve,{show:t.isShowEvent,"onUpdate:show":p[2]||(p[2]=m=>t.isShowEvent=m)},{default:L(()=>[k(g,{type:"card",modelValue:t.eventActiveName,"onUpdate:modelValue":p[1]||(p[1]=m=>t.eventActiveName=m)},{default:L(()=>[(_(!0),S(O,null,$(t.eventList,m=>(_(),D(a,{key:m.key,label:m.label,name:m.key,style:{padding:"0 20px"}},{default:L(()=>[m.key=="redirect"?(_(),D(i,{key:0,modelValue:m.param,"onUpdate:modelValue":n=>m.param=n,type:"textarea",placeholder:"请输入完整的 URL"},null,8,["modelValue","onUpdate:modelValue"])):G("",!0),m.key=="alert"?(_(),D(i,{key:1,modelValue:m.param,"onUpdate:modelValue":n=>m.param=n,type:"textarea",placeholder:"请输入要 alert 的内容"},null,8,["modelValue","onUpdate:modelValue"])):G("",!0),k(h,{style:{"margin-top":"20px"},onClick:n=>v(m.key,m.param)},{default:L(()=>[A("确定")]),_:2},1032,["onClick"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["show"])])}}});const It=B(Dt,[["__scopeId","data-v-03af1cf7"]]),Pt={class:"home"},Vt={class:"left"},At={class:"center"},Ot={class:"right"},Et={key:1,class:"placeholder"},Rt={key:1,class:"placeholder"},Nt={key:1,class:"placeholder"},$t=U({__name:"Home",setup(o){const e=z.editorStore,t=j({activeName:"attr",reSelectAnimateIndex:void 0}),v=()=>{localStorage.getItem("canvasData")&&e.setComponentData(s(JSON.parse(localStorage.getItem("canvasData")))),localStorage.getItem("canvasStyle")&&e.setCanvasStyle(JSON.parse(localStorage.getItem("canvasStyle")))},s=i=>(i.forEach(a=>{a.id=ie()}),i),d=i=>{i.preventDefault(),i.stopPropagation();const a=fe.cloneDeep(de[i.dataTransfer.getData("index")]);a.style.top=i.offsetY,a.style.left=i.offsetX,a.id=ie(),e.addComponent({component:a,index:void 0}),e.recordSnapshot()},p=i=>{i.preventDefault(),i.dataTransfer.dropEffect="copy"},h=()=>{e.setClickComponentStatus(!1)},c=i=>{e.editorState.isClickComponent||e.setCurComponent({component:null,index:null}),i.button!=2&&e.hideContextMenu()};return v(),Me(),(i,a)=>{const g=P("el-tab-pane"),m=P("el-tabs");return _(),S("div",Pt,[k(gt),C("main",null,[C("section",Vt,[k(Ve)]),C("section",At,[C("div",{class:"content",onDrop:d,onDragover:p,onMousedown:h,onMouseup:c},[k(ot)],32)]),C("section",Ot,[k(m,{modelValue:t.activeName,"onUpdate:modelValue":a[0]||(a[0]=n=>t.activeName=n),type:"card"},{default:L(()=>[k(g,{label:"属性",name:"attr"},{default:L(()=>[w(e).editorState.curComponent?(_(),D(Ee,{key:0})):(_(),S("p",Et,"请选择组件"))]),_:1}),k(g,{label:"动画",name:"animation"},{default:L(()=>[w(e).editorState.curComponent?(_(),D(kt,{key:0})):(_(),S("p",Rt,"请选择组件"))]),_:1}),k(g,{label:"事件",name:"events"},{default:L(()=>[w(e).editorState.curComponent?(_(),D(It,{key:0})):(_(),S("p",Nt,"请选择组件"))]),_:1})]),_:1},8,["modelValue"])])])])}}});const Bt=B($t,[["__scopeId","data-v-7076e16c"]]);export{Bt as default};
