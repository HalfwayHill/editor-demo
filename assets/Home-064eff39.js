import{d as $,o as m,c as S,F as N,r as E,a as D,b as J,e as C,t as Q,u as x,l as ue,_ as U,f as j,g as re,h as I,i as k,w as M,j as G,k as z,m as K,v as te,n as W,p as oe,q as H,s as Z,x as F,y as q,z as L,A as de,B as ae,C as pe,D as be,E as ee,G as he,$ as ye,H as O,I as le,J as me,K as ge,L as Se,M as se,N as xe,O as we,P as Ce,Q as ke,R as Me}from"./index-f511004d.js";const Le={class:"component-list"},De=["data-index"],Ie=$({__name:"ComponentList",setup(n){const e=t=>{t.dataTransfer.setData("index",t.target.dataset.index)};return(t,y)=>(m(),S("div",Le,[(m(!0),S(N,null,E(x(ue),(l,u)=>(m(),S("div",{key:u,class:"item",draggable:"true",onDragstart:y[0]||(y[0]=d=>e(d)),"data-index":u},[(m(),D(J(l.icon),{class:"icon"})),C("span",null,Q(l.label),1)],40,De))),128))]))}});const Pe=U(Ie,[["__scopeId","data-v-c47933ae"]]),Ve=[{key:"left",label:"x 坐标"},{key:"top",label:"y 坐标"},{key:"width",label:"宽"},{key:"height",label:"高"},{key:"color",label:"颜色"},{key:"backgroundColor",label:"背景色"},{key:"borderWidth",label:"边框宽度"},{key:"borderStyle",label:"边框风格"},{key:"borderColor",label:"边框颜色"},{key:"borderRadius",label:"边框半径"},{key:"fontSize",label:"字体大小"},{key:"fontWeight",label:"字体粗细"},{key:"lineHeight",label:"行高"},{key:"letterSpacing",label:"字间距"},{key:"textAlign",label:"左右对齐"},{key:"verticalAlign",label:"上下对齐"},{key:"opacity",label:"透明度"}],Ae={class:"attr-list"},Oe=$({__name:"AttrList",setup(n){const e=z.editorStore,t=j({excludes:["Picture","Group"],textAlignOptions:[{label:"左对齐",value:"left"},{label:"居中",value:"center"},{label:"右对齐",value:"right"}],borderStyleOptions:[{label:"实线",value:"solid"},{label:"虚线",value:"dashed"}],verticalAlignOptions:[{label:"上对齐",value:"top"},{label:"居中对齐",value:"middle"},{label:"下对齐",value:"bottom"}],selectKey:["textAlign","borderStyle","verticalAlign"],attributeNameData:Ve}),y=re(()=>{if(e.editorState.curComponent){const u=Object.keys(e.editorState.curComponent.style);return t.attributeNameData.filter(d=>u.includes(d.key))}return[]}),l=re(()=>e.editorState.curComponent);return(u,d)=>{const h=I("el-color-picker"),r=I("el-option"),s=I("el-select"),a=I("el-input"),v=I("el-form-item"),p=I("el-form");return m(),S("div",Ae,[k(p,null,{default:M(()=>[(m(!0),S(N,null,E(y.value,({key:o,label:i},_)=>(m(),D(v,{key:_,label:i},{default:M(()=>[o=="borderColor"?(m(),D(h,{key:0,modelValue:l.value.style[o],"onUpdate:modelValue":f=>l.value.style[o]=f},null,8,["modelValue","onUpdate:modelValue"])):o=="color"?(m(),D(h,{key:1,modelValue:l.value.style[o],"onUpdate:modelValue":f=>l.value.style[o]=f},null,8,["modelValue","onUpdate:modelValue"])):o=="backgroundColor"?(m(),D(h,{key:2,modelValue:l.value.style[o],"onUpdate:modelValue":f=>l.value.style[o]=f},null,8,["modelValue","onUpdate:modelValue"])):t.selectKey.includes(o)?(m(),D(s,{key:3,modelValue:l.value.style[o],"onUpdate:modelValue":f=>l.value.style[o]=f},{default:M(()=>[o=="textAlign"?(m(!0),S(N,{key:0},E(t.textAlignOptions,f=>(m(),D(r,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128)):o=="borderStyle"?(m(!0),S(N,{key:1},E(t.borderStyleOptions,f=>(m(),D(r,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128)):(m(!0),S(N,{key:2},E(t.verticalAlignOptions,f=>(m(),D(r,{key:f.value,label:f.label,value:f.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(m(),D(a,{key:4,type:"number",modelValue:l.value.style[o],"onUpdate:modelValue":f=>l.value.style[o]=f,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label"]))),128)),l.value&&!t.excludes.includes(l.value.component)?(m(),D(v,{key:0,label:"内容"},{default:M(()=>[k(a,{type:"textarea",modelValue:l.value.propValue,"onUpdate:modelValue":d[0]||(d[0]=o=>l.value.propValue=o)},null,8,["modelValue"])]),_:1})):G("",!0)]),_:1})])}}});const Re=U(Oe,[["__scopeId","data-v-cf9a02dc"]]),Ne=$({__name:"ContextMenu",setup(n){const e=z.editorStore;j({copyData:null});const t=()=>{e.setClickComponentStatus(!0)},y=()=>{e.lock()},l=()=>{e.unlock()},u=()=>{e.copy()},d=()=>{e.paste(!0),e.recordSnapshot()},h=()=>{e.cut()},r=()=>{e.deleteComponent(),e.recordSnapshot()},s=()=>{e.upComponent(),e.recordSnapshot()},a=()=>{e.downComponent(),e.recordSnapshot()},v=()=>{e.topComponent(),e.recordSnapshot()},p=()=>{e.bottomComponent(),e.recordSnapshot()};return(o,i)=>K((m(),S("div",{class:"contextmenu",style:W({top:x(e).editorState.menuTop+"px",left:x(e).editorState.menuLeft+"px"})},[C("ul",{onMouseup:t},[x(e).editorState.curComponent?(m(),S(N,{key:0},[x(e).editorState.curComponent.isLock?(m(),S("li",{key:1,onClick:l},"解锁")):(m(),S(N,{key:0},[C("li",{onClick:u},"复制"),C("li",{onClick:d},"粘贴"),C("li",{onClick:h},"剪切"),C("li",{onClick:r},"删除"),C("li",{onClick:y},"锁定"),C("li",{onClick:v},"置顶"),C("li",{onClick:p},"置底"),C("li",{onClick:s},"上移"),C("li",{onClick:a},"下移")],64))],64)):(m(),S("li",{key:1,onClick:d},"粘贴"))],32)],4)),[[te,x(e).editorState.menuShow]])}});const Ee=U(Ne,[["__scopeId","data-v-c1805e3b"]]),$e={class:"mark-line"},Ue=$({__name:"MarkLine",setup(n){const e=z.editorStore,t=new Map,y=(a,v)=>{a&&t.set(v,a)},l=j({lines:["xt","xc","xb","yl","yc","yr"],diff:3,lineStatus:{xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}});oe(()=>{H.on("move",a=>{d(a.isDownward,a.isRightward)}),H.on("unMove",()=>{u()})});const u=()=>{Object.keys(l.lineStatus).forEach(a=>{l.lineStatus[a]=!1})},d=(a,v)=>{const p=e.editorState.componentData,o=Z(e.editorState.curComponent.style),i=o.width/2,_=o.height/2;u(),p.forEach(f=>{if(f==e.editorState.curComponent)return;const g=Z(f.style),{top:c,left:b,bottom:w,right:P}=g,V=g.width/2,A=g.height/2,R={top:[{isNearly:s(o.top,c),lineNode:t.get("xt"),line:"xt",dragShift:c,lineShift:c},{isNearly:s(o.bottom,c),lineNode:t.get("xt"),line:"xt",dragShift:c-o.height,lineShift:c},{isNearly:s(o.top+_,c+A),lineNode:t.get("xc"),line:"xc",dragShift:c+A-_,lineShift:c+A},{isNearly:s(o.top,w),lineNode:t.get("xb"),line:"xb",dragShift:w,lineShift:w},{isNearly:s(o.bottom,w),lineNode:t.get("xb"),line:"xb",dragShift:w-o.height,lineShift:w}],left:[{isNearly:s(o.left,b),lineNode:t.get("yl"),line:"yl",dragShift:b,lineShift:b},{isNearly:s(o.right,b),lineNode:t.get("yl"),line:"yl",dragShift:b-o.width,lineShift:b},{isNearly:s(o.left+i,b+V),lineNode:t.get("yc"),line:"yc",dragShift:b+V-i,lineShift:b+V},{isNearly:s(o.left,P),lineNode:t.get("yr"),line:"yr",dragShift:P,lineShift:P},{isNearly:s(o.right,P),lineNode:t.get("yr"),line:"yr",dragShift:P-o.width,lineShift:P}]},B=[],{rotate:X}=e.editorState.curComponent.style;Object.keys(R).forEach(Y=>{R[Y].forEach(T=>{T.isNearly&&(e.setShapeSingleStyle({key:Y,value:X!=0?h(Y,T,o):T.dragShift}),T.lineNode.style[Y]=`${T.lineShift}px`,B.push(T.line))})}),B.length&&r(B,a,v)})},h=(a,v,p)=>{const{width:o,height:i}=e.editorState.curComponent.style;return a=="top"?Math.round(v.dragShift-(i-p.height)/2):Math.round(v.dragShift-(o-p.width)/2)},r=(a,v,p)=>{p?a.includes("yr")?l.lineStatus.yr=!0:a.includes("yc")?l.lineStatus.yc=!0:a.includes("yl")&&(l.lineStatus.yl=!0):a.includes("yl")?l.lineStatus.yl=!0:a.includes("yc")?l.lineStatus.yc=!0:a.includes("yr")&&(l.lineStatus.yr=!0),v?a.includes("xb")?l.lineStatus.xb=!0:a.includes("xc")?l.lineStatus.xc=!0:a.includes("xt")&&(l.lineStatus.xt=!0):a.includes("xt")?l.lineStatus.xt=!0:a.includes("xc")?l.lineStatus.xc=!0:a.includes("xb")&&(l.lineStatus.xb=!0)},s=(a,v)=>Math.abs(a-v)<=l.diff;return(a,v)=>(m(),S("div",$e,[(m(!0),S(N,null,E(l.lines,p=>K((m(),S("div",{key:p,class:F(["line",p.includes("x")?"xline":"yline"]),ref_for:!0,ref:o=>y(o,p)},null,2)),[[te,l.lineStatus[p]||!1]])),128))]))}});const Be=U(Ue,[["__scopeId","data-v-ffbd92d2"]]);async function fe(n,e=[]){if(n){const t=y=>new Promise(l=>{n.classList.add("animate__animated","animate__"+y.value);const u=()=>{n.removeEventListener("animationend",u),n.removeEventListener("animationcancel",u),n.classList.remove("animate__animated","animate__"+y.value),l()};n.addEventListener("animationend",u),n.addEventListener("animationcancel",u)});for(let y=0,l=e.length;y<l;y++)await t(e[y])}else console.log("runAnimation el为空")}const Ye={lt:Xe,t:We,rt:Te,r:je,rb:He,b:qe,lb:ze,l:Ge};function Xe(n,e,t,y,l){const{symmetricPoint:u}=l;let d=q(e,u),h=L(e,d,-n.rotate),r=L(u,d,-n.rotate),s=r.x-h.x,a=r.y-h.y;if(y){s/a>t?(h.x+=Math.abs(s-a*t),s=a*t):(h.y+=Math.abs(a-s/t),a=s/t);const v=L(h,d,n.rotate);d=q(v,u),h=L(v,d,-n.rotate),r=L(u,d,-n.rotate),s=r.x-h.x,a=r.y-h.y}s>0&&a>0&&(n.width=Math.round(s),n.height=Math.round(a),n.left=Math.round(h.x),n.top=Math.round(h.y))}function Te(n,e,t,y,l){const{symmetricPoint:u}=l;let d=q(e,u),h=L(e,d,-n.rotate),r=L(u,d,-n.rotate),s=h.x-r.x,a=r.y-h.y;if(y){s/a>t?(h.x-=Math.abs(s-a*t),s=a*t):(h.y+=Math.abs(a-s/t),a=s/t);const v=L(h,d,n.rotate);d=q(v,u),h=L(v,d,-n.rotate),r=L(u,d,-n.rotate),s=h.x-r.x,a=r.y-h.y}s>0&&a>0&&(n.width=Math.round(s),n.height=Math.round(a),n.left=Math.round(r.x),n.top=Math.round(h.y))}function He(n,e,t,y,l){const{symmetricPoint:u}=l;let d=q(e,u),h=L(u,d,-n.rotate),r=L(e,d,-n.rotate),s=r.x-h.x,a=r.y-h.y;if(y){s/a>t?(r.x-=Math.abs(s-a*t),s=a*t):(r.y-=Math.abs(a-s/t),a=s/t);const v=L(r,d,n.rotate);d=q(v,u),h=L(u,d,-n.rotate),r=L(v,d,-n.rotate),s=r.x-h.x,a=r.y-h.y}s>0&&a>0&&(n.width=Math.round(s),n.height=Math.round(a),n.left=Math.round(h.x),n.top=Math.round(h.y))}function ze(n,e,t,y,l){const{symmetricPoint:u}=l;let d=q(e,u),h=L(u,d,-n.rotate),r=L(e,d,-n.rotate),s=h.x-r.x,a=r.y-h.y;if(y){s/a>t?(r.x+=Math.abs(s-a*t),s=a*t):(r.y-=Math.abs(a-s/t),a=s/t);const v=L(r,d,n.rotate);d=q(v,u),h=L(u,d,-n.rotate),r=L(v,d,-n.rotate),s=h.x-r.x,a=r.y-h.y}s>0&&a>0&&(n.width=Math.round(s),n.height=Math.round(a),n.left=Math.round(r.x),n.top=Math.round(h.y))}function We(n,e,t,y,l){const{symmetricPoint:u,curPoint:d}=l,h=L(e,d,-n.rotate),r=L({x:d.x,y:h.y},d,n.rotate),s=Math.sqrt((r.x-u.x)**2+(r.y-u.y)**2),a={x:r.x-(r.x-u.x)/2,y:r.y+(u.y-r.y)/2};let v=n.width;y&&(v=s*t),n.width=v,n.height=Math.round(s),n.top=Math.round(a.y-s/2),n.left=Math.round(a.x-n.width/2)}function je(n,e,t,y,l){const{symmetricPoint:u,curPoint:d}=l,h=L(e,d,-n.rotate),r=L({x:h.x,y:d.y},d,n.rotate),s=Math.sqrt((r.x-u.x)**2+(r.y-u.y)**2),a={x:r.x-(r.x-u.x)/2,y:r.y+(u.y-r.y)/2};let v=n.height;y&&(v=s/t),n.height=v,n.width=Math.round(s),n.top=Math.round(a.y-n.height/2),n.left=Math.round(a.x-s/2)}function qe(n,e,t,y,l){const{symmetricPoint:u,curPoint:d}=l,h=L(e,d,-n.rotate),r=L({x:d.x,y:h.y},d,n.rotate),s=Math.sqrt((r.x-u.x)**2+(r.y-u.y)**2),a={x:r.x-(r.x-u.x)/2,y:r.y+(u.y-r.y)/2};let v=n.width;y&&(v=s*t),n.width=v,n.height=Math.round(s),n.top=Math.round(a.y-s/2),n.left=Math.round(a.x-n.width/2)}function Ge(n,e,t,y,l){const{symmetricPoint:u,curPoint:d}=l,h=L(e,d,-n.rotate),r=L({x:h.x,y:d.y},d,n.rotate),s=Math.sqrt((r.x-u.x)**2+(r.y-u.y)**2),a={x:r.x-(r.x-u.x)/2,y:r.y+(u.y-r.y)/2};let v=n.height;y&&(v=s/t),n.height=v,n.width=Math.round(s),n.top=Math.round(a.y-n.height/2),n.left=Math.round(a.x-s/2)}function Ke(n,e,t,y,l,u){Ye[n](e,t,y,l,u)}const Fe=["onMousedown"],Je=$({__name:"ShapeComponent",props:{active:{type:Boolean,default:!1},element:{require:!0,type:Object},defaultStyle:{require:!0,type:Object},index:{require:!0,type:[Number,String]}},setup(n){const e=n,t=z.editorStore,y=de(),l=j({pointList:["lt","t","rt","r","rb","b","lb","l"],initialAngle:{lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315},angleToCursor:[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}],cursors:{}});oe(()=>{t.editorState.curComponent&&(l.cursors=r()),H.on("runAnimation",()=>{e.element===t.getCurComponent&&y.value!==void 0&&fe(y.value,t.getCurComponent.animations)})});const u=()=>{var o;return e.active&&!((o=e.element)!=null&&o.isLock)},d=o=>{var B;t.setClickComponentStatus(!0),o.preventDefault(),o.stopPropagation();const i={...e.defaultStyle},_=o.clientY,f=o.clientX,g=i.rotate,c=(B=y.value)==null?void 0:B.getBoundingClientRect(),b=(c==null?void 0:c.left)+(c==null?void 0:c.width)/2,w=(c==null?void 0:c.top)+(c==null?void 0:c.height)/2,P=Math.atan2(_-w,f-b)/(Math.PI/180);let V=!1;const A=X=>{V=!0;const Y=X.clientX,T=X.clientY,ve=Math.atan2(T-w,Y-b)/(Math.PI/180);i.rotate=g+ve-P,t.setShapeStyle(i)},R=()=>{V&&t.recordSnapshot(),document.removeEventListener("mousemove",A),document.removeEventListener("mouseup",R),l.cursors=r()};document.addEventListener("mousemove",A),document.addEventListener("mouseup",R)},h=o=>{var A,R;const i=(A=e.defaultStyle)==null?void 0:A.height,_=(R=e.defaultStyle)==null?void 0:R.width,f=/t/.test(o),g=/b/.test(o),c=/l/.test(o),b=/r/.test(o);let w=0,P=0;return o.length===2?(w=c?0:_,P=f?0:i):((f||g)&&(w=_/2,P=f?0:i),(c||b)&&(w=c?0:_,P=Math.floor(i/2))),{marginLeft:"-4px",marginTop:"-4px",left:`${w}px`,top:`${P}px`,cursor:l.cursors[o]}},r=()=>{const o=ae(t.editorState.curComponent.style.rotate),i={};let _=-1;return l.pointList.forEach(f=>{const g=ae(l.initialAngle[f]+o),c=l.angleToCursor.length;for(;;){_=(_+1)%c;const b=l.angleToCursor[_];if(g<23||g>=338){i[f]="nw-resize";return}if(b.start<=g&&g<b.end){i[f]=b.cursor+"-resize";return}}}),i},s=o=>{var V,A,R;if(t.setClickComponentStatus(!0),((V=e.element)==null?void 0:V.component)!="v-text"&&((A=e.element)==null?void 0:A.component)!="rect-shape"&&o.preventDefault(),o.stopPropagation(),t.setCurComponent({component:e.element,index:e.index}),(R=e.element)!=null&&R.isLock)return;l.cursors=r();const i={...e.defaultStyle},_=o.clientY,f=o.clientX,g=Number(i.top),c=Number(i.left);let b=!1;const w=B=>{b=!0;const X=B.clientX,Y=B.clientY;i.top=Y-_+g,i.left=X-f+c,t.setShapeStyle(i),be(()=>{H.emit("move",{isDownward:Y-_>0,isRightward:X-f>0})})},P=()=>{b&&t.recordSnapshot(),H.emit("unMove"),document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",P)};document.addEventListener("mousemove",w),document.addEventListener("mouseup",P)},a=o=>{o.stopPropagation(),o.preventDefault(),t.hideContextMenu()},v=(o,i)=>{t.setClickComponentStatus(!0),i.stopPropagation(),i.preventDefault();const _={...e.defaultStyle},f=_.width/_.height,g={x:_.left+_.width/2,y:_.top+_.height/2},c=t.editorState.editor.getBoundingClientRect(),b=i.target.getBoundingClientRect(),w={x:Math.round(b.left-c.left+i.target.offsetWidth/2),y:Math.round(b.top-c.top+i.target.offsetHeight/2)},P={x:g.x-(w.x-g.x),y:g.y-(w.y-g.y)};let V=!1,A=!0;const R=p(),B=Y=>{if(A){A=!1;return}V=!0;const T={x:Y.clientX-c.left,y:Y.clientY-c.top};Ke(o,_,T,f,R,{center:g,curPoint:w,symmetricPoint:P}),t.setShapeStyle(_)},X=()=>{document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",X),V&&t.recordSnapshot()};document.addEventListener("mousemove",B),document.addEventListener("mouseup",X)},p=()=>{var i;if(((i=e.element)==null?void 0:i.component)!="Group")return!1;const o=[0,90,180,360];for(const _ of e.element.propValue)if(!o.includes(ae(parseInt(_.style.rotate))))return!0;return!1};return(o,i)=>{const _=I("RefreshRight"),f=I("el-icon");return m(),S("div",{ref_key:"thisRef",ref:y,class:F(["shape",{active:n.active}]),onClick:a,onMousedown:s},[K(k(f,{class:"el-icon-refresh-right",onMousedown:d},{default:M(()=>[k(_)]),_:1},512),[[te,u()]]),(m(!0),S(N,null,E(u()?l.pointList:[],g=>(m(),S("div",{class:"shape-point",onMousedown:c=>v(g,c),key:g,style:W(h(g))},null,44,Fe))),128)),pe(o.$slots,"default",{},void 0,!0)],34)}}});const Qe=U(Je,[["__scopeId","data-v-413fb51b"]]),Ze=$({__name:"AreaComponent",props:{start:{type:Object},width:{type:Number},height:{type:Number}},setup(n){return(e,t)=>(m(),S("div",{style:W({left:n.start.x+"px",top:n.start.y+"px",width:n.width+"px",height:n.height+"px"}),class:"area"},null,4))}});const et=U(Ze,[["__scopeId","data-v-b92f54dd"]]),tt=$({__name:"EditorComponent",props:{isEdit:{type:Boolean,default:!0}},setup(n){const e=j({editorX:0,editorY:0,start:{x:0,y:0},width:0,height:0,isShowArea:!1}),t=z.editorStore;oe(()=>{t.getEditor(),H.on("hideArea",()=>{l()})});const y=p=>{const o=t.editorState.curComponent;(!o||o.component!="v-text"&&o.component!="rect-shape")&&p.preventDefault(),l();const i=t.editorState.editor.getBoundingClientRect();e.editorX=i.x,e.editorY=i.y;const _=p.clientX,f=p.clientY;e.start.x=_-e.editorX,e.start.y=f-e.editorY,e.isShowArea=!0;const g=b=>{e.width=Math.abs(b.clientX-_),e.height=Math.abs(b.clientY-f),b.clientX<_&&(e.start.x=b.clientX-e.editorX),b.clientY<f&&(e.start.y=b.clientY-e.editorY)},c=b=>{if(document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",c),b.clientX==_&&b.clientY==f){l();return}u()};document.addEventListener("mousemove",g),document.addEventListener("mouseup",c)},l=()=>{e.isShowArea=!1,e.width=0,e.height=0,t.setAreaData({style:{left:0,top:0,width:0,height:0},components:[]})},u=()=>{const p=d();if(p.length<=1){l();return}let o=1/0,i=1/0,_=-1/0,f=-1/0;p.forEach(g=>{let c={};g.component=="VGroup"?g.propValue.forEach(b=>{const w=ye(`#component${b.id}`).getBoundingClientRect();c.left=w.left-e.editorX,c.top=w.top-e.editorY,c.right=w.right-e.editorX,c.bottom=w.bottom-e.editorY,c.left<i&&(i=c.left),c.top<o&&(o=c.top),c.right>_&&(_=c.right),c.bottom>f&&(f=c.bottom)}):c=Z(g.style),c.left<i&&(i=c.left),c.top<o&&(o=c.top),c.right>_&&(_=c.right),c.bottom>f&&(f=c.bottom)}),e.start.x=i,e.start.y=o,e.width=_-i,e.height=f-o,t.setAreaData({style:{left:i,top:o,width:e.width,height:e.height},components:p})},d=()=>{const p=[],{x:o,y:i}=e.start;return t.editorState.componentData.forEach(_=>{if(_.isLock)return;const{left:f,top:g,width:c,height:b}=Z(_.style);o<=f&&i<=g&&f+c<=o+e.width&&g+b<=i+e.height&&p.push(_)}),p},h=p=>{p.stopPropagation(),p.preventDefault();let o=p.target,i=p.offsetY,_=p.offsetX;for(;o instanceof SVGElement;)o=o.parentNode;for(;!o.className.includes("editor");)_+=o.offsetLeft,i+=o.offsetTop,o=o.parentNode;t.showContextMenu({top:i,left:_})},r=p=>{const o={};return["width","height","top","left","rotate"].forEach(i=>{i!="rotate"?o[i]=p[i]+"px":o.transform="rotate("+p[i]+"deg)"}),o},s=p=>he(p,["top","left","width","height","rotate"]),a=(p,o)=>{t.setShapeStyle({height:v(p,o)})},v=(p,o)=>{let{lineHeight:i,fontSize:_,height:f}=p.style;i===""&&(i=1.5);const g=(o.split("<br>").length-1)*i*_;return f>g?f:g};return(p,o)=>(m(),S("div",{class:F(["editor",{edit:n.isEdit}]),id:"editor",style:W({width:x(ee)(x(t).editorState.canvasStyleData.width)+"px",height:x(ee)(x(t).editorState.canvasStyleData.height)+"px"}),onContextmenu:h,onMousedown:y},[(m(!0),S(N,null,E(x(t).editorState.componentData,(i,_)=>(m(),D(Qe,{defaultStyle:i.style,style:W(r(i.style)),key:i.id,active:i.id===(x(t).editorState.curComponent||{}).id,element:i,index:_,class:F({lock:i.isLock})},{default:M(()=>[i.component!="v-text"?(m(),D(J(i.component),{key:0,class:"component",style:W(s(i.style)),propValue:i.propValue,element:i,id:"component"+i.id},null,8,["style","propValue","element","id"])):(m(),D(J(i.component),{key:1,class:"component",style:W(s(i.style)),propValue:i.propValue,onInput:a,element:i,id:"component"+i.id},null,40,["style","propValue","element","id"]))]),_:2},1032,["defaultStyle","style","active","element","index","class"]))),128)),k(Ee),k(Be),K(k(et,{start:e.start,width:e.width,height:e.height},null,8,["start","width","height"]),[[te,e.isShowArea]])],38))}});const ot=U(tt,[["__scopeId","data-v-c6f3bafb"]]),ie={redirect(n){n&&(window.location.href=n)},alert(n){n&&alert(n)}},nt=[{key:"redirect",label:"跳转事件",event:ie.redirect,param:""},{key:"alert",label:"alert 事件",event:ie.alert,param:""}],at=$({__name:"ComponentWrapper",props:{config:{}},setup(n){const e=n,t=de();oe(()=>{t.value!==void 0&&fe(t.value,e.config.animations)});const y=()=>{const l=e.config.events;Object.keys(l).forEach(u=>{ie[u](l[u])})};return(l,u)=>(m(),S("div",{onClick:y,ref_key:"wrapperDom",ref:t},[(m(),D(J(l.config.component),{class:"component",style:W(x(he)(l.config.style)),propValue:l.config.propValue,element:l.config},null,8,["style","propValue","element"]))],512))}});const lt=U(at,[["__scopeId","data-v-f9a224a7"]]),st={key:0,class:"bg"},it={class:"canvas-container"},rt=$({__name:"Preview",props:{show:{type:Boolean}},emits:["update:show"],setup(n,{emit:e}){const t=z.editorStore.editorState,y=()=>{e("update:show",!1)};return(l,u)=>{const d=I("el-button");return l.show?(m(),S("div",st,[k(d,{onClick:y,class:"close"},{default:M(()=>[O("关闭")]),_:1}),C("div",it,[C("div",{class:"canvas",style:W({width:x(ee)(x(t).canvasStyleData.width)+"px",height:x(ee)(x(t).canvasStyleData.height)+"px"})},[(m(!0),S(N,null,E(x(t).componentData,(h,r)=>(m(),D(lt,{key:r,config:h},null,8,["config"]))),128))],4)])])):G("",!0)}}});const ct=U(rt,[["__scopeId","data-v-6b193d50"]]),ne=n=>(Ce("data-v-5c55aeb6"),n=n(),ke(),n),ut={class:"toolbar"},dt=ne(()=>C("label",{for:"input",class:"insert"},"插入图片",-1)),pt={class:"canvas-config"},ht=ne(()=>C("span",null,"画布大小",-1)),mt=ne(()=>C("span",null,"*",-1)),ft={class:"canvas-config"},_t=ne(()=>C("span",null,"画布比例",-1)),vt=$({__name:"Toolbar",setup(n){const e=z.editorStore,t=j({isShowPreview:!1,needToChange:["top","left","width","height","fontSize","borderWidth"],scale:100,timer:null}),y=g=>g*t.scale/100,l=g=>{const c=e.editorState.canvasStyleData.scale;return g/(c/100)},u=()=>{clearTimeout(t.timer),t.timer=setTimeout(()=>{t.scale=~~t.scale||1;const g=me.cloneDeep(e.editorState.componentData);g.forEach(c=>{Object.keys(c.style).forEach(b=>{t.needToChange.includes(b)&&(c.style[b]=Math.ceil(y(l(c.style[b]))))})}),e.setComponentData(g),e.setCanvasStyle({...e.editorState.canvasStyleData,scale:t.scale})},1e3)},d=()=>{e.lock()},h=()=>{e.unlock()},r=()=>{e.compose(),e.recordSnapshot()},s=()=>{e.decompose(),e.recordSnapshot()},a=()=>{e.undo()},v=()=>{e.redo()},p=g=>{const c=g.target.files[0];if(!c.type.includes("image")){ge("只能插入图片");return}const b=new FileReader;b.onload=w=>{const P=w.target.result,V=new Image;V.onload=()=>{var A,R;e.addComponent({component:{...Se,id:se(),component:"v-picture",label:"图片",icon:"",propValue:P,style:{...xe,top:0,left:0,width:V.width,height:V.height}},index:void 0}),e.recordSnapshot(),(A=document.querySelector("#input"))==null||A.setAttribute("type","text"),(R=document.querySelector("#input"))==null||R.setAttribute("type","file")},V.src=P},b.readAsDataURL(c)},o=()=>{t.isShowPreview=!0,e.setEditMode("preview")},i=()=>{e.setEditMode("edit")},_=()=>{localStorage.setItem("canvasData",JSON.stringify(e.editorState.componentData)),localStorage.setItem("canvasStyle",JSON.stringify(e.editorState.canvasStyleData)),we.success("保存成功")},f=()=>{e.setCurComponent({component:null,index:null}),e.setComponentData([]),e.recordSnapshot()};return H.on("preview",o),H.on("save",_),H.on("clearCanvas",f),t.scale=e.editorState.canvasStyleData.scale,(g,c)=>{const b=I("el-button");return m(),S("div",null,[C("div",ut,[k(b,{onClick:a},{default:M(()=>[O("撤消")]),_:1}),k(b,{onClick:v},{default:M(()=>[O("重做")]),_:1}),dt,C("input",{type:"file",onChange:p,id:"input",hidden:""},null,32),k(b,{onClick:o,style:{"margin-left":"10px"}},{default:M(()=>[O("预览")]),_:1}),k(b,{onClick:_},{default:M(()=>[O("保存")]),_:1}),k(b,{onClick:f},{default:M(()=>[O("清空画布")]),_:1}),k(b,{onClick:r,disabled:!x(e).editorState.areaData.components.length},{default:M(()=>[O("组合")]),_:1},8,["disabled"]),k(b,{onClick:s,disabled:!x(e).editorState.curComponent||x(e).editorState.curComponent.isLock||x(e).editorState.curComponent.component!="VGroup"},{default:M(()=>[O("拆分")]),_:1},8,["disabled"]),k(b,{onClick:d,disabled:!x(e).editorState.curComponent||x(e).editorState.curComponent.isLock},{default:M(()=>[O("锁定")]),_:1},8,["disabled"]),k(b,{onClick:h,disabled:!x(e).editorState.curComponent||!x(e).editorState.curComponent.isLock},{default:M(()=>[O("解锁")]),_:1},8,["disabled"]),C("div",pt,[ht,K(C("input",{"onUpdate:modelValue":c[0]||(c[0]=w=>x(e).editorState.canvasStyleData.width=w)},null,512),[[le,x(e).editorState.canvasStyleData.width]]),mt,K(C("input",{"onUpdate:modelValue":c[1]||(c[1]=w=>x(e).editorState.canvasStyleData.height=w)},null,512),[[le,x(e).editorState.canvasStyleData.height]])]),C("div",ft,[_t,K(C("input",{"onUpdate:modelValue":c[2]||(c[2]=w=>t.scale=w),onInput:u},null,544),[[le,t.scale]]),O(" % ")])]),k(ct,{show:t.isShowPreview,"onUpdate:show":c[3]||(c[3]=w=>t.isShowPreview=w),onChange:i},null,8,["show"])])}}});const bt=U(vt,[["__scopeId","data-v-5c55aeb6"]]),ce=[{label:"进入",children:[{label:"渐显",value:"fadeIn"},{label:"向右进入",value:"fadeInLeft"},{label:"向左进入",value:"fadeInRight"},{label:"向上进入",value:"fadeInUp"},{label:"向下进入",value:"fadeInDown"},{label:"向右长距进入",value:"fadeInLeftBig"},{label:"向左长距进入",value:"fadeInRightBig"},{label:"向上长距进入",value:"fadeInUpBig"},{label:"向下长距进入",value:"fadeInDownBig"},{label:"旋转进入",value:"rotateIn"},{label:"左顺时针旋转",value:"rotateInDownLeft"},{label:"右逆时针旋转",value:"rotateInDownRight"},{label:"左逆时针旋转",value:"rotateInUpLeft"},{label:"右逆时针旋转",value:"rotateInUpRight"},{label:"弹入",value:"bounceIn"},{label:"向右弹入",value:"bounceInLeft"},{label:"向左弹入",value:"bounceInRight"},{label:"向上弹入",value:"bounceInUp"},{label:"向下弹入",value:"bounceInDown"},{label:"光速从右进入",value:"lightSpeedIn"},{label:"光速从右退出",value:"lightSpeedOut"},{label:"中心X轴旋转",value:"flipInX"},{label:"中心Y轴旋转",value:"flipInY"},{label:"左长半径旋转",value:"rollIn"},{label:"由小变大进入",value:"zoomIn"},{label:"左变大进入",value:"zoomInLeft"},{label:"右变大进入",value:"zoomInRight"},{label:"向上变大进入",value:"zoomInUp"},{label:"向下变大进入",value:"zoomInDown"},{label:"向右滑动展开",value:"slideInLeft"},{label:"向左滑动展开",value:"slideInRight"},{label:"向上滑动展开",value:"slideInUp"},{label:"向下滑动展开",value:"slideInDown"}]},{label:"强调",children:[{label:"弹跳",value:"bounce"},{label:"闪烁",value:"flash"},{label:"放大缩小",value:"pulse"},{label:"放大缩小弹簧",value:"rubberBand"},{label:"左右晃动",value:"headShake"},{label:"左右扇形摇摆",value:"swing"},{label:"放大晃动缩小",value:"tada"},{label:"扇形摇摆",value:"wobble"},{label:"左右上下晃动",value:"jello"},{label:"Y轴旋转",value:"flip"}]},{label:"退出",children:[{label:"渐隐",value:"fadeOut"},{label:"向左退出",value:"fadeOutLeft"},{label:"向右退出",value:"fadeOutRight"},{label:"向上退出",value:"fadeOutUp"},{label:"向下退出",value:"fadeOutDown"},{label:"向左长距退出",value:"fadeOutLeftBig"},{label:"向右长距退出",value:"fadeOutRightBig"},{label:"向上长距退出",value:"fadeOutUpBig"},{label:"向下长距退出",value:"fadeOutDownBig"},{label:"旋转退出",value:"rotateOut"},{label:"左顺时针旋转",value:"rotateOutDownLeft"},{label:"右逆时针旋转",value:"rotateOutDownRight"},{label:"左逆时针旋转",value:"rotateOutUpLeft"},{label:"右逆时针旋转",value:"rotateOutUpRight"},{label:"弹出",value:"bounceOut"},{label:"向左弹出",value:"bounceOutLeft"},{label:"向右弹出",value:"bounceOutRight"},{label:"向上弹出",value:"bounceOutUp"},{label:"向下弹出",value:"bounceOutDown"},{label:"中心X轴旋转",value:"flipOutX"},{label:"中心Y轴旋转",value:"flipOutY"},{label:"左长半径旋转",value:"rollOut"},{label:"由小变大退出",value:"zoomOut"},{label:"左变大退出",value:"zoomOutLeft"},{label:"右变大退出",value:"zoomOutRight"},{label:"向上变大退出",value:"zoomOutUp"},{label:"向下变大退出",value:"zoomOutDown"},{label:"向左滑动收起",value:"slideOutLeft"},{label:"向右滑动收起",value:"slideOutRight"},{label:"向上滑动收起",value:"slideOutUp"},{label:"向下滑动收起",value:"slideOutDown"}]}],yt=$({__name:"Modal",props:{show:{type:Boolean}},emits:["update:show"],setup(n,{emit:e}){const t=()=>{e("update:show")},y=l=>{l.stopPropagation()};return(l,u)=>l.show?(m(),S("div",{key:0,class:"modal-bg",onClick:t},[C("div",{class:"fadeInLeft animated modal",onClick:y},[pe(l.$slots,"default",{},void 0,!0)])])):G("",!0)}});const _e=U(yt,[["__scopeId","data-v-b4747281"]]),gt={class:"animation-list"},St={key:0,class:"div-animation"},xt={class:"el-scrollbar-view"},wt=["onMouseover","onClick"],Ct=$({__name:"AnimationList",setup(n){const e=z.editorStore,t=j({isShowAnimation:!1,animationClassData:ce,animationActiveName:"进入",showAnimatePanel:!1,hoverPreviewAnimate:""}),y=d=>{e.addAnimation(d),t.isShowAnimation=!1},l=()=>{H.emit("runAnimation")},u=d=>{e.removeAnimation(d)};return(d,h)=>{const r=I("el-button"),s=I("el-tag"),a=I("el-scrollbar"),v=I("el-tab-pane"),p=I("el-tabs");return m(),S("div",gt,[x(e).editorState.curComponent?(m(),S("div",St,[k(r,{onClick:h[0]||(h[0]=o=>{t.isShowAnimation=!0})},{default:M(()=>[O("添加动画")]),_:1}),k(r,{onClick:l},{default:M(()=>[O("预览动画")]),_:1}),C("div",null,[(m(!0),S(N,null,E(x(e).editorState.curComponent.animations,(o,i)=>(m(),D(s,{key:i,closable:"",onClose:_=>u(i)},{default:M(()=>[O(Q(o.label),1)]),_:2},1032,["onClose"]))),128))])])):G("",!0),k(_e,{show:t.isShowAnimation,"onUpdate:show":h[2]||(h[2]=o=>t.isShowAnimation=o)},{default:M(()=>[k(p,{type:"card",modelValue:t.animationActiveName,"onUpdate:modelValue":h[1]||(h[1]=o=>t.animationActiveName=o)},{default:M(()=>[(m(!0),S(N,null,E(x(ce),o=>(m(),D(v,{key:o.label,label:o.label,name:o.label},{default:M(()=>[k(a,{class:"animate-container"},{default:M(()=>[C("div",xt,[(m(!0),S(N,null,E(o.children,(i,_)=>(m(),S("div",{class:"animate",key:_,onMouseover:f=>t.hoverPreviewAnimate=i.value,onClick:f=>y(i)},[C("div",{class:F([t.hoverPreviewAnimate===i.value&&"animate__animated animate__"+i.value])},Q(i.label),3)],40,wt))),128))])]),_:2},1024)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["show"])])}}});const kt=U(Ct,[["__scopeId","data-v-41b1b119"]]),Mt={class:"event-list"},Lt={key:0,class:"div-events"},Dt=$({__name:"EventList",setup(n){const e=z.editorStore,t=j({isShowEvent:!1,eventURL:"",eventActiveName:"redirect",eventList:nt}),y=(u,d)=>{t.isShowEvent=!1,e.addEvent({event:u,param:d})},l=u=>{e.removeEvent(u)};return(u,d)=>{const h=I("el-button"),r=I("el-tag"),s=I("el-input"),a=I("el-tab-pane"),v=I("el-tabs");return m(),S("div",Mt,[x(e).editorState.curComponent?(m(),S("div",Lt,[k(h,{onClick:d[0]||(d[0]=p=>t.isShowEvent=!0)},{default:M(()=>[O("添加事件")]),_:1}),C("div",null,[(m(!0),S(N,null,E(Object.keys(x(e).editorState.curComponent.events),p=>(m(),D(r,{key:p,closable:"",onClose:o=>l(p)},{default:M(()=>[O(Q(p),1)]),_:2},1032,["onClose"]))),128))])])):G("",!0),k(_e,{show:t.isShowEvent,"onUpdate:show":d[2]||(d[2]=p=>t.isShowEvent=p)},{default:M(()=>[k(v,{type:"card",modelValue:t.eventActiveName,"onUpdate:modelValue":d[1]||(d[1]=p=>t.eventActiveName=p)},{default:M(()=>[(m(!0),S(N,null,E(t.eventList,p=>(m(),D(a,{key:p.key,label:p.label,name:p.key,style:{padding:"0 20px"}},{default:M(()=>[p.key=="redirect"?(m(),D(s,{key:0,modelValue:p.param,"onUpdate:modelValue":o=>p.param=o,type:"textarea",placeholder:"请输入完整的 URL"},null,8,["modelValue","onUpdate:modelValue"])):G("",!0),p.key=="alert"?(m(),D(s,{key:1,modelValue:p.param,"onUpdate:modelValue":o=>p.param=o,type:"textarea",placeholder:"请输入要 alert 的内容"},null,8,["modelValue","onUpdate:modelValue"])):G("",!0),k(h,{style:{"margin-top":"20px"},onClick:o=>y(p.key,p.param)},{default:M(()=>[O("确定")]),_:2},1032,["onClick"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["show"])])}}});const It=U(Dt,[["__scopeId","data-v-03af1cf7"]]),Pt={class:"home"},Vt={class:"left"},At={class:"center"},Ot={class:"right"},Rt={key:1,class:"placeholder"},Nt={key:1,class:"placeholder"},Et={key:1,class:"placeholder"},$t=$({__name:"Home",setup(n){const e=z.editorStore,t=j({activeName:"attr",reSelectAnimateIndex:void 0}),y=()=>{localStorage.getItem("canvasData")&&e.setComponentData(l(JSON.parse(localStorage.getItem("canvasData")))),localStorage.getItem("canvasStyle")&&e.setCanvasStyle(JSON.parse(localStorage.getItem("canvasStyle")))},l=s=>(s.forEach(a=>{a.id=se()}),s),u=s=>{s.preventDefault(),s.stopPropagation();const a=s.dataTransfer.getData("index"),v=e.editorState.editor.getBoundingClientRect();if(a){const p=me.cloneDeep(ue[a]);p.style.top=s.offsetY-v.y,p.style.left=s.offsetX-v.x,p.id=se(),e.addComponent({component:p,index:void 0}),e.recordSnapshot()}},d=s=>{s.preventDefault(),s.dataTransfer.dropEffect="copy"},h=()=>{e.setClickComponentStatus(!1)},r=s=>{e.editorState.isClickComponent||e.setCurComponent({component:null,index:null}),s.button!=2&&e.hideContextMenu()};return y(),Me(),(s,a)=>{const v=I("el-tab-pane"),p=I("el-tabs");return m(),S("div",Pt,[k(bt),C("main",null,[C("section",Vt,[k(Pe)]),C("section",At,[C("div",{class:"content",onDrop:u,onDragover:d,onMousedown:h,onMouseup:r},[k(ot)],32)]),C("section",Ot,[k(p,{modelValue:t.activeName,"onUpdate:modelValue":a[0]||(a[0]=o=>t.activeName=o),type:"card"},{default:M(()=>[k(v,{label:"属性",name:"attr"},{default:M(()=>[x(e).editorState.curComponent?(m(),D(Re,{key:0})):(m(),S("p",Rt,"请选择组件"))]),_:1}),k(v,{label:"动画",name:"animation"},{default:M(()=>[x(e).editorState.curComponent?(m(),D(kt,{key:0})):(m(),S("p",Nt,"请选择组件"))]),_:1}),k(v,{label:"事件",name:"events"},{default:M(()=>[x(e).editorState.curComponent?(m(),D(It,{key:0})):(m(),S("p",Et,"请选择组件"))]),_:1})]),_:1},8,["modelValue"])])])])}}});const Bt=U($t,[["__scopeId","data-v-6eff9911"]]);export{Bt as default};
